dev.off()
figure <- grid.arrange(plot2, plot1, nrow = 2, ncol = 1)
pdf(file="/Volumes/Jellyfish/Dropbox/Manuscripts/_ Under Revision/Global Estimates of the Extent of Algal Forests/Figure.pdf",height=12,width=10)
figure
dev.off()
pdf(file="/Volumes/Jellyfish/Dropbox/Manuscripts/_ Under Revision/Global Estimates of the Extent of Algal Forests/Figure.pdf",height=12,width=10)
print(figure)
dev.off()
dev.off()
pdf(file="/Volumes/Jellyfish/Dropbox/Manuscripts/_ Under Revision/Global Estimates of the Extent of Algal Forests/Figure.pdf",height=12,width=10)
print(figure)
dev.off()
figure <- ggarrange(plot2, plot1,
labels = c("A", "B"),
ncol = 1, nrow = 2)
??ggarrange
library(ggpub)
library(ggpubr)
figure <- ggarrange(plot2, plot1,
labels = c("A", "B"),
ncol = 1, nrow = 2)
figure
pdf(file="/Volumes/Jellyfish/Dropbox/Manuscripts/_ Under Revision/Global Estimates of the Extent of Algal Forests/Figure.pdf",height=12,width=10)
figure
dev.off()
png(file="/Volumes/Jellyfish/Dropbox/Manuscripts/_ Under Revision/Global Estimates of the Extent of Algal Forests/Figure.png",height=3000,width=3000)
figure
dev.off()
a <- raster("/Volumes/Jellyfish/Dropbox/Manuscripts/_ Under Revision/Global Estimates of the Extent of Algal Forests/Global Seaweed Area Estimates Niche Model/Results/EnsembleReclass.tif")
sum(getValues(raster::area(a) * a),na.rm=T)
3444250 * 0.52
rm(list=(ls()[ls()!="v"]))
gc(reset=TRUE)
library(stats)
inds <- seq(as.Date("2014-06-01"), as.Date("2015-10-14"), by = "day")
inds
as.numeric(format(inds[1], "%j"))
install.packages("sdmpredictors")
library(sdmpredictors)
maximumThermalConditions <- load_layers("BO2_tempmax_ss")
maximumThermalConditions
plot(maximumThermalConditions)
maximumThermalConditions
library(raster)
library(raster)
plot(maximumThermalConditions)
sourve("https://raw.githubusercontent.com/jorgeassis/courseMarineEcologicalModelling/master/Sessions%20%5BP%5D/sourceFunctions.R")
source("https://raw.githubusercontent.com/jorgeassis/courseMarineEcologicalModelling/master/Sessions%20%5BP%5D/sourceFunctions.R")
source("https://raw.githubusercontent.com/jorgeassis/courseMarineEcologicalModelling/master/Sessions%20%5BP%5D/sourceFunctions.R")
source("https://raw.githubusercontent.com/jorgeassis/courseMarineEcologicalModelling/master/Sessions%20%5BP%5D/sourceFunctions.R")
cat("All packages are correctly installed and loaded")
cat("All packages are correctly installed and loaded")
source("https://raw.githubusercontent.com/jorgeassis/courseMarineEcologicalModelling/master/Sessions%20%5BP%5D/sourceFunctions.R")
source("https://raw.githubusercontent.com/jorgeassis/courseMarineEcologicalModelling/master/Sessions%20%5BP%5D/sourceFunctions.R")
source("https://raw.githubusercontent.com/jorgeassis/courseMarineEcologicalModelling/master/Sessions%20%5BP%5D/sourceFunctions.R")
source("https://raw.githubusercontent.com/jorgeassis/courseMarineEcologicalModelling/master/Sessions%20%5BP%5D/sourceFunctions.R")
source("https://raw.githubusercontent.com/jorgeassis/courseMarineEcologicalModelling/master/Sessions%20%5BP%5D/sourceFunctions.R")
source("https://raw.githubusercontent.com/jorgeassis/courseMarineEcologicalModelling/master/Sessions%20%5BP%5D/sourceFunctions.R")
source("https://raw.githubusercontent.com/jorgeassis/courseMarineEcologicalModelling/master/Sessions%20%5BP%5D/sourceFunctions.R")
source("https://raw.githubusercontent.com/jorgeassis/courseMarineEcologicalModelling/master/Sessions%20%5BP%5D/sourceFunctions.R")
source("https://raw.githubusercontent.com/jorgeassis/courseMarineEcologicalModelling/master/Sessions%20%5BP%5D/sourceFunctions.R")
source("https://raw.githubusercontent.com/jorgeassis/courseMarineEcologicalModelling/master/Sessions%20%5BP%5D/sourceFunctions.R")
source("https://raw.githubusercontent.com/jorgeassis/courseMarineEcologicalModelling/master/Sessions%20%5BP%5D/sourceFunctions.R")
source("https://raw.githubusercontent.com/jorgeassis/courseMarineEcologicalModelling/master/Sessions%20%5BP%5D/sourceFunctions.R")
source("https://raw.githubusercontent.com/jorgeassis/courseMarineEcologicalModelling/master/Sessions%20%5BP%5D/sourceFunctions.R")
install.packages("SDMtune")
install.packages("SDMtune")
source("https://raw.githubusercontent.com/jorgeassis/courseMarineEcologicalModelling/master/Sessions%20%5BP%5D/sourceFunctions.R")
detach("dismo")
source("https://raw.githubusercontent.com/jorgeassis/courseMarineEcologicalModelling/master/Sessions%20%5BP%5D/sourceFunctions.R")
remove.packages("SDMtune")
source("https://raw.githubusercontent.com/jorgeassis/courseMarineEcologicalModelling/master/Sessions%20%5BP%5D/sourceFunctions.R")
install.packages(package)
install.packages(package, type = "source")
source("https://raw.githubusercontent.com/jorgeassis/courseMarineEcologicalModelling/master/Sessions%20%5BP%5D/sourceFunctions.R")
source("https://raw.githubusercontent.com/jorgeassis/courseMarineEcologicalModelling/master/Sessions%20%5BP%5D/sourceFunctions.R")
library(rWind)
uv2ds(1, 1)
uv2ds(1, 1)
library(raster)
file <- "/Volumes/Jellyfish/Dropbox/Manuscripts/Bio-ORACLE Across Climate Changes/Bioclimatic Layers BO3.0/Present/Surface/LongTerm/SeaWaterVelocityY Surface Pred Mean.tif"
file <- raster(file)
file
file2 <- "/Volumes/Jellyfish/Dropbox/SeaWaterDirection Surface Mean 2010-2020.tif"
raster(file2)
file <- "/Volumes/Jellyfish/Dropbox/Manuscripts/Bio-ORACLE Across Climate Changes/Bioclimatic Layers BO3.0/Present/Surface/LongTerm/SeaWaterVelocityY Surface Pred Mean.tif"
fileR <- raster(file)
file2 <- "/Volumes/Jellyfish/Dropbox/SeaWaterDirection Surface Mean 2010-2020.tif"
file2R <-raster(file2)
?resample
fileFR <- resample(file2R,fileR)
plot(fileFR)
fileFR
plot(file2R)
plot(fileR)
writeRaster(fileFR,file=file2, format="GTiff", overwrite=TRUE)
file <- "/Volumes/Jellyfish/Dropbox/Manuscripts/Bio-ORACLE Across Climate Changes/Bioclimatic Layers BO3.0/Present/Surface/LongTerm/SeaWaterVelocityY Surface Pred Mean.tif"
fileR <- raster(file)
file2 <- "/Volumes/Jellyfish/Dropbox/SeaWaterSpeed Surface Mean 2010-2020.tif"
file2R <-raster(file2)
fileFR <- resample(file2R,fileR)
writeRaster(fileFR,file=file2, format="GTiff", overwrite=TRUE)
file <- "/Volumes/Jellyfish/Dropbox/Manuscripts/Bio-ORACLE Across Climate Changes/Bioclimatic Layers BO3.0/Present/Surface/LongTerm/SeaWaterVelocityY Surface Pred Mean.tif"
fileR <- raster(file)
file2 <- "/Volumes/Jellyfish/Dropbox/WindDirection Surface Mean 2010-2020.tif"
file2R <-raster(file2)
fileFR <- resample(file2R,fileR)
writeRaster(fileFR,file=file2, format="GTiff", overwrite=TRUE)
file <- "/Volumes/Jellyfish/Dropbox/Manuscripts/Bio-ORACLE Across Climate Changes/Bioclimatic Layers BO3.0/Present/Surface/LongTerm/SeaWaterVelocityY Surface Pred Mean.tif"
fileR <- raster(file)
file2 <- "/Volumes/Jellyfish/Dropbox/WindSpeed Surface Mean 2010-2020.tif"
file2R <-raster(file2)
fileFR <- resample(file2R,fileR)
writeRaster(fileFR,file=file2, format="GTiff", overwrite=TRUE)
list.files("/Volumes/Jellyfish/Dropbox/Data/Distribution Models/Global distribution of marine forests/Results [Full models]/_ Per Species")
files <- list.files("/Volumes/Jellyfish/Dropbox/Data/Distribution Models/Global distribution of marine forests/Results [Full models]/_ Per Species", recursive = T, full.names = T)
files
grepl("Maps/Global/",files)]
files <- files[grepl("Maps/Global/",files)]
files
files <- files[!grepl("Maps/Global/SD_",files)]
files
files
files <- list.files("/Volumes/Jellyfish/Dropbox/Data/Distribution Models/Global distribution of marine forests/Results [Full models]/_ Per Species", recursive = T, full.names = T)
files <- files[grepl("Maps/Global/",files)]
files <- files[!grepl("Maps/Global/SD_",files)]
f = files[1]
f
dump <- "/Volumes/Jellyfish2/Backup [Ongoing studies]/Future diversity of marine forests in a changing climate/Data/"
f.to <- gsub("/Volumes/Jellyfish/Dropbox/Data/Distribution Models/Global distribution of marine forests/Results [Full models]/_ Per Species/Acrocarpia paniculata/Maps/Global/",
dump,
f)
f.to
dump
f
f.to <- gsub("/Volumes/Jellyfish/Dropbox/Data/Distribution Models/Global distribution of marine forests/Results \\[Full models]\\/_ Per Species/Acrocarpia paniculata/Maps/Global/",
dump,
f)
f.to
file.copy(f,f.to)
?file.copy
file.copy(f,f.to,opy.mode = TRUE)
file.copy(f,f.to,copy.mode = TRUE)
f
raster(f)
library(raster)
raster(f)
f.to
dump <- "/Volumes/Jellyfish2/Backup [Ongoing studies]/Future diversity of marine forests in a changing climate/Data/Distribution Models/"
f.to <- gsub("/Volumes/Jellyfish/Dropbox/Data/Distribution Models/Global distribution of marine forests/Results \\[Full models]\\/_ Per Species/Acrocarpia paniculata/Maps/Global/",
dump,
f)
file.copy(f,f.to,copy.mode = TRUE)
files
file.copy(f,f.to,copy.mode = TRUE, overwrite=TRUE)
file.copy(f,f.to,copy.mode = TRUE, overwrite=TRUE, recursive=T
}
file.copy(f,f.to,copy.mode = TRUE, overwrite=TRUE, recursive=T)
file.copy(f,f.to,copy.mode = TRUE, overwrite=TRUE, recursive=TRUE)
file.copy(f,f.to,copy.mode = TRUE, overwrite=TRUE)
file.copy(f,f.to,copy.mode = TRUE, overwrite=TRUE)
f.to
raster(f.to)
file.copy(f,f.to, overwrite=TRUE)
raster(f.to)
system(paste0("cp -R ",f," ",f.to)
file.copy(f,f.to, overwrite=TRUE)
}
system(paste0("cp -R ",f," ",f.to))
paste0("cp -R ",f," ",f.to)
system(paste0("cp -R '",f,"' '",f.to,"'"))
raster(f.to)
plot(raster(f.to))
f.to <- gsub("/Volumes/Jellyfish/Dropbox/Data/Distribution Models/Global distribution of marine forests/Results \\[Full models]\\/_ Per Species/",
dump,
f)
f.to
gsub("/Maps/Global/","/",f.to)
f.to <- gsub("/Maps/Global/","/",f.to)
files <- list.files("/Volumes/Jellyfish/Dropbox/Data/Distribution Models/Global distribution of marine forests/Results [Full models]/_ Per Species", recursive = T, full.names = T)
files <- files[grepl("Maps/Global/",files)]
files <- files[!grepl("Maps/Global/SD_",files)]
dump <- "/Volumes/Jellyfish2/Backup [Ongoing studies]/Future diversity of marine forests in a changing climate/Data/Distribution Models/"
f <- files[1]
f
f.to <- gsub("/Volumes/Jellyfish/Dropbox/Data/Distribution Models/Global distribution of marine forests/Results \\[Full models]\\/_ Per Species/",
dump,
f)
f.to <- gsub("/Maps/Global/","/",f.to)
system(paste0("cp -R '",f,"' '",f.to,"'"))
f.to
system(paste0("cp -Rv '",f,"' '",f.to,"'"))
f.to
gregexpr("/",f.to)
unlist(gregexpr("/",f.to))
substr(f.to,1,unlist(gregexpr("/",f.to))[length(unlist(gregexpr("/",f.to)))])
f.to.folder <- substr(f.to,1,unlist(gregexpr("/",f.to))[length(unlist(gregexpr("/",f.to)))])
paste0("mkdir '",f.to.folder,"'")
system(paste0("mkdir '",f.to.folder,"'"))
f.to
system(paste0("cp -R '",f,"' '",f.to,"'"))
system(paste0("cp -R '",f,"' '",f.to,"'"))
system(paste0("cp -R '",f,"' '",f.to,"'"))
raster(f.to)
files <- list.files("/Volumes/Jellyfish/Dropbox/Data/Distribution Models/Global distribution of marine forests/Results [Full models]/_ Per Species", recursive = T, full.names = T)
files <- files[grepl("Maps/Global/",files)]
files <- files[!grepl("Maps/Global/SD_",files)]
dump <- "/Volumes/Jellyfish2/Backup [Ongoing studies]/Future diversity of marine forests in a changing climate/Data/Distribution Models/"
for( f in files ) {
f.to <- gsub("/Volumes/Jellyfish/Dropbox/Data/Distribution Models/Global distribution of marine forests/Results \\[Full models]\\/_ Per Species/",
dump,
f)
f.to <- gsub("/Maps/Global/","/",f.to)
f.to.folder <- substr(f.to,1,unlist(gregexpr("/",f.to))[length(unlist(gregexpr("/",f.to)))])
system(paste0("mkdir '",f.to.folder,"'"))
system(paste0("cp -R '",f,"' '",f.to,"'"))
}
files <- list.files("/Volumes/Jellyfish/Dropbox/Data/Distribution Models/Global distribution of marine forests/Results [Full models]/_ Per Species", recursive = T, full.names = T)
files <- files[grepl("Maps/Global/",files)]
files <- files[grepl("Reclass",files)]
files <- files[!grepl("Reachable_",files)]
files <- files[!grepl("Maps/Global/SD_",files)]
files
files <- list.files("/Volumes/Jellyfish/Dropbox/Data/Distribution Models/Global distribution of marine forests/Results [Full models]/_ Per Species", recursive = T, full.names = T)
files <- files[grepl("Maps/Global/",files)]
files <- files[grepl("Reclass",files)]
files <- files[!grepl("Reachable_",files)]
files <- files[!grepl("Maps/Global/SD_",files)]
dump <- "/Volumes/Jellyfish2/Backup [Ongoing studies]/Future diversity of marine forests in a changing climate/Data/Distribution Models/"
for( f in files ) {
f.to <- gsub("/Volumes/Jellyfish/Dropbox/Data/Distribution Models/Global distribution of marine forests/Results \\[Full models]\\/_ Per Species/",
dump,
f)
f.to <- gsub("/Maps/Global/","/",f.to)
f.to.folder <- substr(f.to,1,unlist(gregexpr("/",f.to))[length(unlist(gregexpr("/",f.to)))])
system(paste0("mkdir '",f.to.folder,"'"))
system(paste0("cp -R '",f,"' '",f.to,"'"))
}
files <- list.files("/Volumes/Jellyfish/Dropbox/Data/Distribution Models/Global distribution of marine forests/Results [Full models]/_ Per Species", recursive = T, full.names = T)
files <- files[grepl("Maps/Global/",files)]
files <- files[grepl("Reclass",files)]
files <- files[!grepl("Reachable_",files)]
files
files <- files[!grepl("GainLoss",files)]
files
files <- files[!grepl("Maps/Global/SD_",files)]
files <- list.files("/Volumes/Jellyfish/Dropbox/Data/Distribution Models/Global distribution of marine forests/Results [Full models]/_ Per Species", recursive = T, full.names = T)
files <- files[grepl("Maps/Global/",files)]
files <- files[grepl("Reclass",files)]
files <- files[!grepl("Reachable_",files)]
files <- files[!grepl("GainLoss",files)]
files <- files[!grepl("Maps/Global/SD_",files)]
dump <- "/Volumes/Jellyfish2/Backup [Ongoing studies]/Future diversity of marine forests in a changing climate/Data/Distribution Models/"
for( f in files ) {
f.to <- gsub("/Volumes/Jellyfish/Dropbox/Data/Distribution Models/Global distribution of marine forests/Results \\[Full models]\\/_ Per Species/",
dump,
f)
f.to <- gsub("/Maps/Global/","/",f.to)
f.to.folder <- substr(f.to,1,unlist(gregexpr("/",f.to))[length(unlist(gregexpr("/",f.to)))])
system(paste0("mkdir '",f.to.folder,"'"))
system(paste0("cp -R '",f,"' '",f.to,"'"))
}
files <- list.files("/Volumes/Jellyfish/Dropbox/Data/Distribution Models/Global distribution of seagrasses/Results [Full models]/_ Per Species", recursive = T, full.names = T)
files <- files[grepl("Maps/Global/",files)]
files <- files[grepl("Reclass",files)]
files <- files[!grepl("Reachable_",files)]
files <- files[!grepl("GainLoss",files)]
files <- files[!grepl("Maps/Global/SD_",files)]
files
dump <- "/Volumes/Jellyfish2/Backup [Ongoing studies]/Future diversity of seagrass forests in a changing climate/Data/Distribution Models/"
files <- list.files("/Volumes/Jellyfish/Dropbox/Data/Distribution Models/Global distribution of seagrasses/Results [Full models]/_ Per Species", recursive = T, full.names = T)
files <- files[grepl("Maps/Global/",files)]
files <- files[grepl("Reclass",files)]
files <- files[!grepl("Reachable_",files)]
files <- files[!grepl("GainLoss",files)]
files <- files[!grepl("Maps/Global/SD_",files)]
dump <- "/Volumes/Jellyfish2/Backup [Ongoing studies]/Future diversity of seagrass forests in a changing climate/Data/Distribution Models/"
for( f in files ) {
f.to <- gsub("/Volumes/Jellyfish/Dropbox/Data/Distribution Models/Global distribution of seagrasses/Results \\[Full models]\\/_ Per Species/",
dump,
f)
f.to <- gsub("/Maps/Global/","/",f.to)
f.to.folder <- substr(f.to,1,unlist(gregexpr("/",f.to))[length(unlist(gregexpr("/",f.to)))])
system(paste0("mkdir '",f.to.folder,"'"))
system(paste0("cp -R '",f,"' '",f.to,"'"))
}
files <- list.files("/Volumes/Jellyfish/Dropbox/Data/Distribution Models/Global distribution of seagrasses/Results [Full models]/_ Per Species", recursive = T, full.names = T)
files <- files[grepl("Maps/Global/",files)]
files <- files[grepl("Reclass",files)]
files <- files[!grepl("Reachable_",files)]
files <- files[!grepl("GainLoss",files)]
files <- files[!grepl("Maps/Global/SD_",files)]
dump <- "/Volumes/Jellyfish2/Backup [Ongoing studies]/Future diversity of seagrass forests in a changing climate/Data/Distribution Models/"
for( f in files ) {
f.to <- gsub("/Volumes/Jellyfish/Dropbox/Data/Distribution Models/Global distribution of seagrasses/Results \\[Full models]\\/_ Per Species/",
dump,
f)
f.to <- gsub("/Maps/Global/","/",f.to)
f.to.folder <- substr(f.to,1,unlist(gregexpr("/",f.to))[length(unlist(gregexpr("/",f.to)))])
system(paste0("mkdir '",f.to.folder,"'"))
system(paste0("cp -R '",f,"' '",f.to,"'"))
}
remove.packages("rmapshaper")
source("sourceFunctions.R")
setwd("/Volumes/Jellyfish/Dropbox/Tutoring/Classes & Courses/Ecological Niche Modelling and Climate Change/Main Contents/Sessions P/Recipes/A complete example")
source("sourceFunctions.R")
# load clean occurrence data with two columns only for Lon and Lat (follow Recipe 1)
presences <- read.csv("Data/mycleanRecords.csv", sep = ";")
# load layers from hard disk
list.files("Data/Present", full.names = T)
environmentalConditions <- stack(list.files("Data/Present", full.names = T))
# crop layers to the European extent
myExtent <- c(-20,50,20,60)
environmentalConditions <- crop(environmentalConditions,myExtent)
# plot predictors
plot(environmentalConditions)
# generate pseudo absences
pseudoAbs <- pseudoAbsences(environmentalConditions,presences,n=1000)
# extract environmental values and make a data.frame with PA information
modelData <- prepareModelData(presences,pseudoAbs,environmentalConditions)
# Generate cross validation folds
folds <- getBlocks(modelData)
# define monotonicity constrains (-1 for negative, +1 for positive, 0 for non-monotonicity)
names(environmentalConditions)
monotonicity = data.frame(DissolvedMolecularOxygen_Benthic_Mean_Pred_Mean=+1,
OceanTemperature_Benthic_Mean_Pred_LtMax=-1,
OceanTemperature_Benthic_Mean_Pred_LtMin=+1,
SeaWaterVelocity_Benthic_Mean_Pred_LtMin=+1,
Slope=+1,
TotalPrimaryProductionPhyto_Benthic_Mean_Pred_LtMin=+1)
monotonicity = data.frame(DissolvedMolecularOxygen_Benthic_Mean_Pred_Mean=+1,
OceanTemperature_Benthic_Mean_Pred_LtMax=-1,
OceanTemperature_Benthic_Mean_Pred_LtMin=+1,
SeaWaterVelocity_Benthic_Mean_Pred_LtMin=+1,
TotalPrimaryProductionPhyto_Benthic_Mean_Pred_LtMin=+1)
monotonicity
# fit a BRT model with cross-validation and
model <- train("BRT", modelData, folds = folds)
# given a set of possible hyperparameter values for BRT
h <- list(interaction.depth = c(1,2,3,4,5) , shrinkage = c(0.1,0.01,0.001) )
# test all possible combinations of hyperparameter values
exp1 <- gridSearch(model, hypers = h, metric = "auc")
plot(exp1)
exp1@results
exp1@results[which.max(exp1@results$test_AUC),]
# fit a BRT model to the dataset with the best hyperparameter values
model <- train("BRT", modelData, folds = folds , interaction.depth=5, shrinkage=0.001 )
getAUC(model, test = TRUE)
# determine relative variable contribution
viModel <- varImp(model, permut = 5)
plotVarImp(viModel)
# reduce model complexity by dropping one variable at a time
reducedModel <- reduceVar(model, th = 5, metric = "auc", permut = 5)
# determine the final relative variable contribution
viModel <- varImp(reducedModel, permut = 5)
viModel
plotVarImp(viModel)
# reduce model complexity by dropping one variable at a time
reducedModel <- reduceVar(model, th = 2, metric = "auc", permut = 5)
# reduce model complexity by dropping one variable at a time
reducedModel <- reduceVar(model, th = 1, metric = "auc", permut = 5)
# determine the final performance as AUC
getAUC(reducedModel, test = TRUE)
# determine the final relative variable contribution
viModel <- varImp(reducedModel, permut = 5)
viModel
plotResponse(reducedModel, var = "OceanTemperature_Benthic_Mean_Pred_LtMin", type = "logistic", only_presence = FALSE, marginal = FALSE, rug = FALSE, color="Black")
plotResponse(reducedModel, var = "TotalPrimaryProductionPhyto_Benthic_Mean_Pred_LtMin", type = "logistic", only_presence = FALSE, marginal = FALSE, rug = FALSE, color="Black")
# reduce model complexity by dropping one variable at a time
reducedModel <- reduceVar(model, th = 5, metric = "auc", permut = 5)
# determine the final performance as AUC
getAUC(reducedModel, test = TRUE)
# determine the final relative variable contribution
viModel <- varImp(reducedModel, permut = 5)
viModel
plotVarImp(viModel)
# inspect response curves
names(environmentalConditions)
# inspect response curves
names(environmentalConditions)
reducedModel
reducedModel@models
reducedModel@folds
reducedModel@data
nams(reducedModel)
names(reducedModel)
# predict with BRT to raster stack
mapPresent <- predict(reducedModel, environmentalConditions, type=c("logistic"))
plot(mapPresent)
# determine the threshold maximizing the sum of sensitivity and specificity
threshold <- thresholdMaxTSS(reducedModel)
threshold
# generate a reclassification table
thresholdConditions <- data.frame(from = c(0,threshold) , to=c(threshold,1) , reclassValue=c(0,1))
thresholdConditions
# apply threshold to reclassify the predictive surface
mapPresentReclass <- reclassify(mapPresent, rcl = thresholdConditions)
plot(mapPresentReclass)
# determine model performance
getAccuracy(reducedModel,threshold = threshold)
getAUC(reducedModel, test = TRUE)
# load layers of sea surface temperatures for the future
environmentalConditionsRCP26 <- stack(list.files("Data/Future RCP26", full.names = T))
# crop layers to the European extent
environmentalConditionsRCP26 <- crop(environmentalConditionsRCP26,myExtent)
# predict with BRT to raster stack
mapRCP26 <- predict(reducedModel, environmentalConditionsRCP26, type=c("logistic"))
source("sourceFunctions.R")
## -----------------------
# 01. open final records
# load clean occurrence data with two columns only for Lon and Lat (follow Recipe 1)
presences <- read.csv("Data/mycleanRecords.csv", sep = ";")
## -----------------------
# 02. load and crop environmental layers
# load layers
layerCodes <- list_layers(datasets = "Bio-ORACLE")
View(layerCodes)
environmentalConditions <- load_layers(c("BO2_tempmin_bdmean", "BO2_tempmax_bdmean", "BO2_dissoxmean_bdmean", "BO2_ppmean_bdmean"))
# load layers from hard disk
list.files("Data/Present", full.names = T)
environmentalConditions <- stack(list.files("Data/Present", full.names = T))
# crop layers to the European extent
myExtent <- c(-20,47.5,10,60)
environmentalConditions <- crop(environmentalConditions,myExtent)
# crop to intertidal region (along shore) if that is the case
# maskCoastLine <- raster("Data/RasterLayers/CoastLine.tif")
# maskCoastLine <- crop(maskCoastLine,environmentalConditions)
# environmentalConditions <- mask(environmentalConditions,maskCoastLine)
# plot predictors
plot(environmentalConditions)
# load layers from hard disk [alternative]
list.files("Data/Present", full.names = T)
environmentalConditions <- stack(list.files("Data/Present", full.names = T))
# crop layers to the European extent
myExtent <- c(-20,47.5,10,60)
environmentalConditions <- crop(environmentalConditions,myExtent)
# plot predictors
plot(environmentalConditions)
# generate pseudo absences
pseudoAbs <- pseudoAbsences(environmentalConditions,presences,n=1000)
# extract environmental values and make a data.frame with PA information
modelData <- prepareModelData(presences,pseudoAbs,environmentalConditions)
# Generate cross validation folds
folds <- getBlocks(modelData)
monotonicity = data.frame(DissolvedMolecularOxygen_Benthic_Mean_Pred_Mean=+1,
OceanTemperature_Benthic_Mean_Pred_LtMax=-1,
OceanTemperature_Benthic_Mean_Pred_LtMin=+1,
SeaWaterVelocity_Benthic_Mean_Pred_LtMin=+1,
TotalPrimaryProductionPhyto_Benthic_Mean_Pred_Mean=+1)
monotonicity
# fit a BRT model with cross-validation and
model <- train("BRT", modelData, folds = folds)
# given a set of possible hyperparameter values for BRT
h <- list(interaction.depth = c(1,2,3,4,5) , shrinkage = c(0.1,0.01,0.001) )
# test all possible combinations of hyperparameter values
exp1 <- gridSearch(model, hypers = h, metric = "auc")
exp1@results[which.max(exp1@results$test_AUC),]
# fit a BRT model to the dataset with the best hyperparameter values
model <- train("BRT", modelData, folds = folds , interaction.depth=1, shrinkage=0.001 )
getAUC(model, test = TRUE)
# determine relative variable contribution
viModel <- varImp(model, permut = 5)
plotVarImp(viModel)
# reduce model complexity by dropping one variable at a time
reducedModel <- reduceVar(model, th = 5, metric = "auc", permut = 5)
# determine the final performance as AUC
getAUC(reducedModel, test = TRUE)
# determine the final relative variable contribution
viModel <- varImp(reducedModel, permut = 5)
viModel
plotVarImp(viModel)
plotResponse(reducedModel, var = "OceanTemperature_Benthic_Mean_Pred_LtMin", type = "logistic", only_presence = FALSE, marginal = FALSE, rug = FALSE, color="Black")
plotResponse(reducedModel, var = "TotalPrimaryProductionPhyto_Benthic_Mean_Pred_Mean", type = "logistic", only_presence = FALSE, marginal = FALSE, rug = FALSE, color="Black")
# predict with BRT to raster stack
mapPresent <- predict(reducedModel, environmentalConditions, type=c("logistic"))
plot(mapPresent)
# determine the threshold maximizing the sum of sensitivity and specificity
threshold <- thresholdMaxTSS(reducedModel)
threshold
# generate a reclassification table
thresholdConditions <- data.frame(from = c(0,threshold) , to=c(threshold,1) , reclassValue=c(0,1))
thresholdConditions
# apply threshold to reclassify the predictive surface
mapPresentReclass <- reclassify(mapPresent, rcl = thresholdConditions)
plot(mapPresentReclass)
# determine model performance
getAccuracy(reducedModel,threshold = threshold)
getAUC(reducedModel, test = TRUE)
# load layers of sea surface temperatures for the future
environmentalConditionsRCP26 <- stack(list.files("Data/Future RCP26", full.names = T))
# crop layers to the European extent
environmentalConditionsRCP26 <- crop(environmentalConditionsRCP26,myExtent)
# predict with BRT to raster stack
mapRCP26 <- predict(reducedModel, environmentalConditionsRCP26, type=c("logistic"))
plot(mapRCP26)
# apply threshold to reclassify the future predictive surface
mapRCP26Reclass <- reclassify(mapRCP26, rcl = thresholdConditions)
plot(mapRCP26Reclass)
# load layers of the future
environmentalConditionsRCP85 <- stack(list.files("Data/Future RCP85", full.names = T))
# crop layers to the European extent
environmentalConditionsRCP85 <- crop(environmentalConditionsRCP85,myExtent)
# predict with BRT to raster stack
mapRCP85 <- predict(reducedModel, environmentalConditionsRCP85, type=c("logistic"))
plot(mapRCP85)
# apply threshold to reclassify the future predictive surface
mapRCP85Reclass <- reclassify(mapRCP85, rcl = thresholdConditions)
plot(mapRCP85Reclass)
par(mfrow=c(1,3))
plot(mapPresentReclass)
plot(mapRCP26Reclass)
plot(mapRCP85Reclass)
